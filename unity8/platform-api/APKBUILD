# Contributor: Bart Ribbers <bribbers@disroot.org>
# Maintainer: Luca Weiss <luca@z3ntu.xyz>
pkgname=platform-api
pkgver=0_git20210520
pkgrel=0
_commit="528721ae561a44cc65671313045c1b92c01b2ef0"
pkgdesc="Platform API for system level capabilities"
arch="all"
url='https://github.com/ubports/platform-api'
license="GPL-3.0-only AND LGPL-3.0-only"
depends_dev="process-cpp-dev lomiri-url-dispatcher-dev location-service-dev"
makedepends="$depends_dev cmake cmake-extras dbus-cpp-dev gtest-dev gmock"
source="$pkgname-$_commit.tar.gz::https://github.com/ubports/$pkgname/archive/$_commit.tar.gz
	0002-Only-use-Hybris-when-available.patch"
subpackages="$pkgname-dev"
builddir="$srcdir/$pkgname-$_commit"

build() {
	cmake -B build \
		-DCMAKE_BUILD_TYPE=Release \
		-DCMAKE_INSTALL_PREFIX=/usr
	make -C build
}

check() {
	cd build
	CTEST_OUTPUT_ON_FAILURE=TRUE ctest
}

package() {
	make -C build DESTDIR="$pkgdir" install
}

sha512sums="
7c8f1182c68a1c619ff1c485528b77c6ee317648c30448eb80a006e77a5c4a76001b5374ad85c6101f965fa18dc604650e0bdb2631e636d9dc0bb8d2f0230cbf  platform-api-528721ae561a44cc65671313045c1b92c01b2ef0.tar.gz
1dceef13de9321c1aaa2f8530ff90c8cdf4359788453575b8e81eca12246f015ca03cc8e0721936b0762e6f087f55bb274049d4213e64b607c9977a69fac3042  0002-Only-use-Hybris-when-available.patch
"
