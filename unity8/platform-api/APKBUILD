# Contributor: Bart Ribbers <bribbers@disroot.org>
# Maintainer: Luca Weiss <luca@z3ntu.xyz>
pkgname=platform-api
pkgver=0_git20181020
pkgrel=0
_commit="54a933236598e750ffe6c9b8a8a76daa8bf1ce0b"
pkgdesc="Platform API for system level capabilities"
arch="all"
url='https://github.com/ubports/platform-api'
license="GPL-3.0-only AND LGPL-3.0-only"
depends_dev="process-cpp-dev url-dispatcher-dev location-service-dev"
makedepends="$depends_dev cmake cmake-extras dbus-cpp-dev gtest-dev gmock"
source="$pkgname-$_commit.tar.gz::https://github.com/ubports/$pkgname/archive/$_commit.tar.gz
	0001-Use-proper-GTest.patch
	0002-Only-use-Hybris-when-available.patch
	0003-Fix-gcc7.patch"
subpackages="$pkgname-dev"
builddir="$srcdir/$pkgname-$_commit"

build() {
	cmake -B build \
		-DCMAKE_BUILD_TYPE=Release \
		-DCMAKE_INSTALL_PREFIX=/usr
	make -C build
}

check() {
	cd build
	CTEST_OUTPUT_ON_FAILURE=TRUE ctest
}

package() {
	make -C build DESTDIR="$pkgdir" install
}

sha512sums="c2b3280a2bdc4f2bf21fe8e2623058b6d5645c10f00236781bab86e6a96b2678ba95c3adf5162c4f6647ce5d7bac566b446f2376dd88bdba59feb70f94308405  platform-api-54a933236598e750ffe6c9b8a8a76daa8bf1ce0b.tar.gz
42f76bd765550e8ddff31e79d6d293470c4ab33bd0058b1ceeeb4b6bd71fd3b5e94736ac1d588889fb41b3c1b6961330335f7294bec8cd1e605260a519cf38fb  0001-Use-proper-GTest.patch
b1d3e27d1ec7b20ff7ec51a2892a2e461d55fe54018c1e9e9e8dc6f84209d617358603bcd10316e978be2e9fc0321717dab51d95bef40eff3e348c40a15df3db  0002-Only-use-Hybris-when-available.patch
5257b6166aa4481d1d72dd2027b742c6abb3c31685c7ad6f155b6b7b0408f5eac811d189454c925444c8943533e07a930f0399214a901d7135de6d70fb79c26e  0003-Fix-gcc7.patch"
