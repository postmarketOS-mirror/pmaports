# Maintainer: Luca Weiss <luca@z3ntu.xyz>
pkgname=click
pkgver=0_git20210325
_commit="c01ac0e7d190552045484e204b5d3a0ad96a2e1e"
pkgrel=0
pkgdesc="Click is a simplified packaging format"
url="https://gitlab.com/ubports/core/click"
arch="all"
license="GPL-3.0-only"
depends_dev="libgee-dev gobject-introspection-dev"
makedepends="$depends_dev cmake intltool vala gobject-introspection autoconf libtool automake json-glib-dev py3-setuptools"
subpackages="$pkgname-dev $pkgname-doc"
source="https://gitlab.com/ubports/core/click/-/archive/$_commit/click-$_commit.tar.gz
	0001-Drop-remaining-translation-bits.patch
	"
builddir="$srcdir/$pkgname-$_commit"
options="!check" # Needs dpkg

build() {
	./autogen.sh
	./configure \
		--build=$CBUILD \
		--host=$CHOST \
		--prefix=/usr \
		--disable-packagekit \
		--disable-systemd
	make
}

check() {
	make check
}

package() {
	make DESTDIR="$pkgdir/" PYTHON_INSTALL_FLAGS="--root=$pkgdir/" install

	# Make abuild's version check happy (#386)
	sed -i s/+ubports//g "$pkgdir"/usr/lib/pkgconfig/*.pc
}

sha512sums="1e3a3e5c6efd4baf541e3aa825b27586d195599c9adf615de5d5ba479b683150c91bdc3813d9b3d0dd43f626a18521e01edd06a499e81407f35c980776390102  click-c01ac0e7d190552045484e204b5d3a0ad96a2e1e.tar.gz
4547333ad36507b300e79db525c93beb48b584e80feb0ebe4497d60d25a1663c3ddcef8d1ed209a471ba5e3cef5a09f545db286a62730ca901b50bff1b4b8197  0001-Drop-remaining-translation-bits.patch"
