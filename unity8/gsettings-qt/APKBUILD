# Maintainer: Luca Weiss <luca@z3ntu.xyz>
pkgname=gsettings-qt
pkgver=0_git20200909
_commit="ce56e46b67c11276ec5f44b6a3a1c3f5a46aafed"
pkgrel=0
pkgdesc="Library to access GSettings from Qt"
url="https://gitlab.com/ubports/core/gsettings-qt"
arch="all"
license="LGPL-3.0-only"
depends_dev="qt5-qtdeclarative-dev"
makedepends="$depends_dev qt5-qtbase-dev"
checkdepends="xvfb-run"
subpackages="$pkgname-dev"
source="https://gitlab.com/ubports/core/gsettings-qt/-/archive/$_commit/gsettings-qt-$_commit.tar.gz"
builddir="$srcdir/$pkgname-$_commit"
options="!check" # Test fails under QEMU

build() {
	qmake-qt5
	make
}

check() {
	LD_LIBRARY_PATH=../src GSETTINGS_BACKEND=memory GSETTINGS_SCHEMA_DIR=. xvfb-run make check
}

package() {
	make INSTALL_ROOT="$pkgdir" install
}

sha512sums="7d4903cc5ff43a0da21f266c3e2b90574b38de382ef85e7dd2ca80b6d29abd3a72a073fac6fb79e3de0b6310e709576fa741a6ac0e2fff0c50817dc27e7720e2  gsettings-qt-ce56e46b67c11276ec5f44b6a3a1c3f5a46aafed.tar.gz"
