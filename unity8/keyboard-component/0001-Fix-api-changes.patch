From a5433b60653c2bbb058dd004aeadc3795b93da12 Mon Sep 17 00:00:00 2001
From: Marius Gripsgard <mariogrip@ubuntu.com>
Date: Sun, 18 Feb 2018 15:53:30 +0100
Subject: [PATCH 1/6] Fix api changes

---
 debian/control                          | 2 +-
 plugins/pinyin/src/pinyinadapter.cpp    | 3 +--
 plugins/westernsupport/spellchecker.cpp | 6 +++---
 3 files changed, 5 insertions(+), 6 deletions(-)

diff --git a/debian/control b/debian/control
index bed4dc35..d5573f9b 100644
--- a/debian/control
+++ b/debian/control
@@ -12,7 +12,7 @@ Build-Depends: debhelper (>= 9),
                libglib2.0-dev,
                libgsettings-qt-dev,
                libhunspell-dev,
-               libpinyin7-dev,
+               libpinyin13-dev,
                libpresage-dev,
                libxml2-utils,
                maliit-framework-dev (>= 0.99.0+git20130615+97e8335-0ubuntu3),
diff --git a/plugins/pinyin/src/pinyinadapter.cpp b/plugins/pinyin/src/pinyinadapter.cpp
index 4f1c6d78..5635d73a 100644
--- a/plugins/pinyin/src/pinyinadapter.cpp
+++ b/plugins/pinyin/src/pinyinadapter.cpp
@@ -58,7 +58,7 @@ void PinyinAdapter::parse(const QString& string)
     std::cout << std::endl;
 #endif
 
-    pinyin_guess_candidates(m_instance, 0);
+    pinyin_guess_candidates(m_instance, 0, SORT_BY_PHRASE_LENGTH_AND_FREQUENCY);
 
     candidates.clear();
     guint len = 0;
@@ -95,4 +95,3 @@ void PinyinAdapter::reset()
 {
     pinyin_reset(m_instance);
 }
-
diff --git a/plugins/westernsupport/spellchecker.cpp b/plugins/westernsupport/spellchecker.cpp
index 0fbde97b..2e774054 100644
--- a/plugins/westernsupport/spellchecker.cpp
+++ b/plugins/westernsupport/spellchecker.cpp
@@ -108,7 +108,7 @@ void SpellCheckerPrivate::addUserDictionary(const QString &user_dictionary)
         if (file.open(QFile::ReadOnly)) {
             QTextStream stream(&file);
             while (!stream.atEnd()) {
-                hunspell->add(codec->fromUnicode(stream.readLine()));
+                hunspell->add(codec->fromUnicode(stream.readLine()).constData());
             }
         }
     }
@@ -191,7 +191,7 @@ bool SpellChecker::spell(const QString &word)
         return true;
     }
 
-    return d->hunspell->spell(d->codec->fromUnicode(word));
+    return d->hunspell->spell(d->codec->fromUnicode(word).constData());
 }
 
 
@@ -273,7 +273,7 @@ void SpellChecker::updateWord(const QString &word)
     }
 
     // Non-zero return value means some error.
-    if (d->hunspell->add(d->codec->fromUnicode(word))) {
+    if (d->hunspell->add(d->codec->fromUnicode(word).constData())) {
         qWarning() << __PRETTY_FUNCTION__ << ": Failed to add '" << word << "' to user dictionary.";
     }
 }
-- 
2.31.1

